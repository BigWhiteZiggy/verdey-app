<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Verdey Bet Verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-gray-100">
  <div id="app"></div>
  <script type="text/babel">
const { useState, useEffect, useRef } = React;

/* ---------- Icon (FIXED: no DOM mutation loops) ---------- */
const Icon = ({ name, size = 20, className = "" }) => {
  const ref = useRef(null);

  useEffect(() => {
    lucide.createIcons();
  }, []);

  return (
    <i
      ref={ref}
      data-lucide={name}
      className={className}
      style={{ width: size, height: size }}
    />
  );
};

/* ---------- Safe localStorage ---------- */
const loadLocal = (key) => {
  try {
    return JSON.parse(localStorage.getItem(key)) || [];
  } catch {
    return [];
  }
};

/* ---------- Main App ---------- */
function App() {
  const [uploadedImage, setUploadedImage] = useState(null);
  const [loading, setLoading] = useState(false);
  const [bets, setBets] = useState([]);
  const [receipts, setReceipts] = useState(() => loadLocal("verdey_receipts"));

  /* Cleanup object URLs (FIXED memory leak) */
  useEffect(() => {
    return () => {
      if (uploadedImage) URL.revokeObjectURL(uploadedImage);
    };
  }, [uploadedImage]);

  /* Persist receipts */
  useEffect(() => {
    localStorage.setItem("verdey_receipts", JSON.stringify(receipts));
  }, [receipts]);

  /* ---------- File Upload ---------- */
  const handleUpload = (file) => {
    if (!file) return;

    if (
      !file.type.startsWith("image/") ||
      !/\.(jpg|jpeg|png)$/i.test(file.name)
    ) {
      alert("Only JPG or PNG images allowed.");
      return;
    }

    setUploadedImage(URL.createObjectURL(file));
  };

  /* ---------- Fake Verification (clearly marked demo) ---------- */
  const verifySlip = async () => {
    if (!uploadedImage) return;
    setLoading(true);

    await new Promise((r) => setTimeout(r, 1200));

    const legit = Math.random() > 0.3;

    setBets((prev) => [
      ...prev,
      {
        id: crypto.randomUUID(), // FIXED duplicate IDs
        result: legit ? "Verified" : "Rejected",
        confidence: legit ? 92 : 41,
      },
    ]);

    setReceipts((prev) => [
      ...prev,
      {
        id: crypto.randomUUID(),
        image: uploadedImage,
        status: legit ? "Verified" : "Rejected",
      },
    ]);

    setLoading(false);
  };

  return (
    <div className="max-w-md mx-auto p-4 space-y-4">
      <h1 className="text-xl font-bold text-center">
        Verdey Bet Slip Verification
      </h1>

      <label className="block p-4 border-2 border-dashed rounded cursor-pointer bg-white">
        <input
          type="file"
          className="hidden"
          onChange={(e) => handleUpload(e.target.files[0])}
        />
        <p className="text-center text-sm text-gray-500">
          Upload bet slip (JPG / PNG)
        </p>
      </label>

      {uploadedImage && (
        <img
          src={uploadedImage}
          className="rounded shadow w-full"
          alt="Uploaded bet"
        />
      )}

      <button
        onClick={verifySlip}
        disabled={loading}
        className="w-full bg-green-600 text-white py-2 rounded disabled:opacity-50"
      >
        {loading ? "Verifying..." : "Verify Bet Slip"}
      </button>

      <p className="text-xs text-gray-500 text-center">
        Demo verification â€” results are simulated.
      </p>

      {/* Results */}
      {bets.map((bet) => (
        <div key={bet.id} className="bg-white p-3 rounded shadow">
          <p className="font-semibold">{bet.result}</p>
          <p className="text-sm text-gray-600">
            Confidence: {bet.confidence}%
          </p>
        </div>
      ))}
    </div>
  );
}
    <script type="text/babel">
const root = ReactDOM.createRoot(document.getElementById("app"));
root.render(<App />);
</script>
</body>
</html>
